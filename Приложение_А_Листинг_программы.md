# ПРИЛОЖЕНИЕ А. ЛИСТИНГ ПРОГРАММЫ

## Файл: Program.cs

```csharp
using System;
using System.Collections.Generic;
using System.Linq;

namespace KursovayaWork
{
    /// <summary>
    /// Главный класс программы
    /// </summary>
    class Program
    {
        private static List<Product> products = new List<Product>();
        private static double minCalories = 0;

        /// <summary>
        /// Главная функция программы
        /// </summary>
        static void Main(string[] args)
        {
            Console.OutputEncoding = System.Text.Encoding.UTF8;
            Console.InputEncoding = System.Text.Encoding.UTF8;

            Console.WriteLine("═══════════════════════════════════════════════════════════");
            Console.WriteLine("   Система решения задачи оптимизации закупки продуктов");
            Console.WriteLine("   Вариант 6: План закупки продуктов для похода");
            Console.WriteLine("═══════════════════════════════════════════════════════════");
            Console.WriteLine();

            bool exit = false;
            while (!exit)
            {
                ShowMainMenu();
                string? choice = Console.ReadLine();

                switch (choice)
                {
                    case "1":
                        FormDataMenu();
                        break;
                    case "2":
                        DisplayData();
                        break;
                    case "3":
                        SolveProblemMenu();
                        break;
                    case "4":
                        SaveDataMenu();
                        break;
                    case "5":
                        LoadDataMenu();
                        break;
                    case "0":
                        exit = true;
                        Console.WriteLine("До свидания!");
                        break;
                    default:
                        Console.WriteLine("Неверный выбор. Попробуйте снова.");
                        break;
                }

                if (!exit)
                {
                    Console.WriteLine("\nНажмите любую клавишу для продолжения...");
                    Console.ReadKey();
                    Console.Clear();
                }
            }
        }

        // ... (остальные методы см. в файле Program.cs)
    }
}
```

## Файл: Product.cs

```csharp
using System;

namespace KursovayaWork
{
    /// <summary>
    /// Класс для представления продукта
    /// </summary>
    public class Product
    {
        /// <summary>
        /// Вес одной упаковки продукта (кг)
        /// </summary>
        public double Weight { get; set; }

        /// <summary>
        /// Калорийность одной упаковки продукта (ккал)
        /// </summary>
        public double Calories { get; set; }

        /// <summary>
        /// Максимальное количество упаковок данного продукта
        /// </summary>
        public int MaxQuantity { get; set; }

        /// <summary>
        /// Удельная калорийность (калорийность на единицу веса)
        /// </summary>
        public double SpecificCalories => Weight > 0 ? Calories / Weight : 0;

        /// <summary>
        /// Конструктор по умолчанию
        /// </summary>
        public Product()
        {
            Weight = 0;
            Calories = 0;
            MaxQuantity = 0;
        }

        /// <summary>
        /// Конструктор с параметрами
        /// </summary>
        /// <param name="weight">Вес упаковки</param>
        /// <param name="calories">Калорийность упаковки</param>
        /// <param name="maxQuantity">Максимальное количество</param>
        public Product(double weight, double calories, int maxQuantity)
        {
            Weight = weight;
            Calories = calories;
            MaxQuantity = maxQuantity;
        }

        /// <summary>
        /// Создание копии продукта
        /// </summary>
        public Product Clone()
        {
            return new Product(Weight, Calories, MaxQuantity);
        }
    }
}
```

## Файл: PurchasePlan.cs

```csharp
using System;
using System.Collections.Generic;
using System.Linq;

namespace KursovayaWork
{
    /// <summary>
    /// Класс для представления плана закупки продуктов
    /// </summary>
    public class PurchasePlan
    {
        /// <summary>
        /// Количество упаковок каждого вида продукта
        /// </summary>
        public List<int> Quantities { get; set; }

        /// <summary>
        /// Список продуктов
        /// </summary>
        public List<Product> Products { get; set; }

        /// <summary>
        /// Общий вес закупки (кг)
        /// </summary>
        public double TotalWeight
        {
            get
            {
                double total = 0;
                for (int i = 0; i < Products.Count && i < Quantities.Count; i++)
                {
                    total += Products[i].Weight * Quantities[i];
                }
                return total;
            }
        }

        /// <summary>
        /// Общая калорийность закупки (ккал)
        /// </summary>
        public double TotalCalories
        {
            get
            {
                double total = 0;
                for (int i = 0; i < Products.Count && i < Quantities.Count; i++)
                {
                    total += Products[i].Calories * Quantities[i];
                }
                return total;
            }
        }

        /// <summary>
        /// Конструктор
        /// </summary>
        /// <param name="products">Список продуктов</param>
        public PurchasePlan(List<Product> products)
        {
            Products = products ?? new List<Product>();
            Quantities = new List<int>(new int[Products.Count]);
        }

        /// <summary>
        /// Создание копии плана
        /// </summary>
        public PurchasePlan Clone()
        {
            var plan = new PurchasePlan(Products.Select(p => p.Clone()).ToList());
            plan.Quantities = new List<int>(Quantities);
            return plan;
        }
    }
}
```

## Файл: Solver.cs

```csharp
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;

namespace KursovayaWork
{
    /// <summary>
    /// Класс для решения задачи оптимизации закупки продуктов
    /// </summary>
    public class Solver
    {
        /// <summary>
        /// Эвристический метод решения (жадный алгоритм)
        /// Сортирует продукты по удельной калорийности и выбирает лучшие
        /// </summary>
        /// <param name="products">Список продуктов</param>
        /// <param name="minCalories">Минимальная требуемая калорийность</param>
        /// <param name="executionTime">Время выполнения (выходной параметр)</param>
        /// <returns>План закупки</returns>
        public static PurchasePlan HeuristicSolve(List<Product> products, double minCalories, out long executionTime)
        {
            Stopwatch sw = Stopwatch.StartNew();

            var plan = new PurchasePlan(products);
            double currentCalories = 0;

            // Создаем список индексов продуктов, отсортированных по убыванию удельной калорийности
            var sortedIndices = Enumerable.Range(0, products.Count)
                .OrderByDescending(i => products[i].SpecificCalories)
                .ToList();

            // Жадный выбор: берем продукты с наибольшей удельной калорийностью
            foreach (int idx in sortedIndices)
            {
                var product = products[idx];
                int quantity = 0;

                // Пытаемся взять максимально возможное количество
                while (quantity < product.MaxQuantity && currentCalories < minCalories)
                {
                    quantity++;
                    currentCalories += product.Calories;
                }

                plan.Quantities[idx] = quantity;

                // Если достигли требуемой калорийности, можно остановиться
                if (currentCalories >= minCalories)
                {
                    break;
                }
            }

            // Если не достигли требуемой калорийности, пытаемся добавить еще продукты
            if (currentCalories < minCalories)
            {
                foreach (int idx in sortedIndices)
                {
                    var product = products[idx];
                    int currentQty = plan.Quantities[idx];

                    while (currentQty < product.MaxQuantity && currentCalories < minCalories)
                    {
                        currentQty++;
                        currentCalories += product.Calories;
                    }

                    plan.Quantities[idx] = currentQty;
                }
            }

            sw.Stop();
            executionTime = sw.ElapsedMilliseconds;

            return plan;
        }

        /// <summary>
        /// Метод полного перебора всех возможных комбинаций
        /// </summary>
        /// <param name="products">Список продуктов</param>
        /// <param name="minCalories">Минимальная требуемая калорийность</param>
        /// <param name="executionTime">Время выполнения (выходной параметр)</param>
        /// <returns>Оптимальный план закупки</returns>
        public static PurchasePlan BruteForceSolve(List<Product> products, double minCalories, out long executionTime)
        {
            Stopwatch sw = Stopwatch.StartNew();

            PurchasePlan? bestPlan = null;
            double bestWeight = double.MaxValue;

            // Вычисляем общее количество комбинаций
            long totalCombinations = 1;
            foreach (var product in products)
            {
                totalCombinations *= (product.MaxQuantity + 1);
                if (totalCombinations > 10000000) // Ограничение для предотвращения переполнения
                {
                    Console.WriteLine("Внимание: Слишком много комбинаций для полного перебора!");
                    Console.WriteLine("Используется ограниченный перебор.");
                    break;
                }
            }

            // Рекурсивный перебор всех комбинаций
            var currentPlan = new PurchasePlan(products);
            BruteForceRecursive(products, minCalories, 0, currentPlan, ref bestPlan, ref bestWeight);

            sw.Stop();
            executionTime = sw.ElapsedMilliseconds;

            if (bestPlan == null)
            {
                // Если не найдено решение, возвращаем пустой план
                return new PurchasePlan(products);
            }

            return bestPlan;
        }

        /// <summary>
        /// Рекурсивная функция для полного перебора
        /// </summary>
        private static void BruteForceRecursive(
            List<Product> products,
            double minCalories,
            int productIndex,
            PurchasePlan currentPlan,
            ref PurchasePlan? bestPlan,
            ref double bestWeight)
        {
            // Если обработали все продукты
            if (productIndex >= products.Count)
            {
                // Проверяем, удовлетворяет ли план требованиям
                if (currentPlan.TotalCalories >= minCalories)
                {
                    // Если это лучший план (минимальный вес)
                    if (currentPlan.TotalWeight < bestWeight)
                    {
                        bestWeight = currentPlan.TotalWeight;
                        bestPlan = currentPlan.Clone();
                    }
                }
                return;
            }

            // Перебираем все возможные количества текущего продукта
            var product = products[productIndex];
            for (int qty = 0; qty <= product.MaxQuantity; qty++)
            {
                currentPlan.Quantities[productIndex] = qty;
                BruteForceRecursive(products, minCalories, productIndex + 1, currentPlan, ref bestPlan, ref bestWeight);
            }
        }
    }
}
```

## Файл: DataManager.cs

```csharp
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;

namespace KursovayaWork
{
    /// <summary>
    /// Класс для управления данными (сохранение и загрузка)
    /// </summary>
    public class DataManager
    {
        /// <summary>
        /// Сохранение данных в текстовый файл
        /// </summary>
        /// <param name="products">Список продуктов</param>
        /// <param name="minCalories">Минимальная требуемая калорийность</param>
        /// <param name="filename">Имя файла</param>
        public static void SaveToTextFile(List<Product> products, double minCalories, string filename)
        {
            try
            {
                using (StreamWriter writer = new StreamWriter(filename, false, Encoding.UTF8))
                {
                    writer.WriteLine(minCalories.ToString());
                    writer.WriteLine(products.Count.ToString());
                    foreach (var product in products)
                    {
                        writer.WriteLine($"{product.Weight};{product.Calories};{product.MaxQuantity}");
                    }
                }
                Console.WriteLine($"Данные успешно сохранены в файл: {filename}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка при сохранении в текстовый файл: {ex.Message}");
            }
        }

        /// <summary>
        /// Загрузка данных из текстового файла
        /// </summary>
        /// <param name="filename">Имя файла</param>
        /// <param name="products">Список продуктов (выходной параметр)</param>
        /// <param name="minCalories">Минимальная требуемая калорийность (выходной параметр)</param>
        /// <returns>Успешность загрузки</returns>
        public static bool LoadFromTextFile(string filename, out List<Product> products, out double minCalories)
        {
            products = new List<Product>();
            minCalories = 0;

            try
            {
                if (!File.Exists(filename))
                {
                    Console.WriteLine($"Файл {filename} не найден.");
                    return false;
                }

                using (StreamReader reader = new StreamReader(filename, Encoding.UTF8))
                {
                    if (!double.TryParse(reader.ReadLine(), out minCalories))
                    {
                        Console.WriteLine("Ошибка чтения минимальной калорийности.");
                        return false;
                    }

                    if (!int.TryParse(reader.ReadLine(), out int count))
                    {
                        Console.WriteLine("Ошибка чтения количества продуктов.");
                        return false;
                    }

                    for (int i = 0; i < count; i++)
                    {
                        string? line = reader.ReadLine();
                        if (string.IsNullOrEmpty(line))
                            break;

                        string[] parts = line.Split(';');
                        if (parts.Length >= 3)
                        {
                            if (double.TryParse(parts[0], out double weight) &&
                                double.TryParse(parts[1], out double calories) &&
                                int.TryParse(parts[2], out int maxQuantity))
                            {
                                products.Add(new Product(weight, calories, maxQuantity));
                            }
                        }
                    }
                }

                Console.WriteLine($"Данные успешно загружены из файла: {filename}");
                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка при загрузке из текстового файла: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// Сохранение данных в двоичный файл (типизированный)
        /// </summary>
        /// <param name="products">Список продуктов</param>
        /// <param name="minCalories">Минимальная требуемая калорийность</param>
        /// <param name="filename">Имя файла</param>
        public static void SaveToBinaryFile(List<Product> products, double minCalories, string filename)
        {
            try
            {
                using (FileStream fs = new FileStream(filename, FileMode.Create))
                using (BinaryWriter writer = new BinaryWriter(fs, Encoding.UTF8))
                {
                    writer.Write(minCalories);
                    writer.Write(products.Count);
                    foreach (var product in products)
                    {
                        writer.Write(product.Weight);
                        writer.Write(product.Calories);
                        writer.Write(product.MaxQuantity);
                    }
                }
                Console.WriteLine($"Данные успешно сохранены в двоичный файл: {filename}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка при сохранении в двоичный файл: {ex.Message}");
            }
        }

        /// <summary>
        /// Загрузка данных из двоичного файла (типизированный)
        /// </summary>
        /// <param name="filename">Имя файла</param>
        /// <param name="products">Список продуктов (выходной параметр)</param>
        /// <param name="minCalories">Минимальная требуемая калорийность (выходной параметр)</param>
        /// <returns>Успешность загрузки</returns>
        public static bool LoadFromBinaryFile(string filename, out List<Product> products, out double minCalories)
        {
            products = new List<Product>();
            minCalories = 0;

            try
            {
                if (!File.Exists(filename))
                {
                    Console.WriteLine($"Файл {filename} не найден.");
                    return false;
                }

                using (FileStream fs = new FileStream(filename, FileMode.Open))
                using (BinaryReader reader = new BinaryReader(fs, Encoding.UTF8))
                {
                    minCalories = reader.ReadDouble();
                    int count = reader.ReadInt32();

                    for (int i = 0; i < count; i++)
                    {
                        double weight = reader.ReadDouble();
                        double calories = reader.ReadDouble();
                        int maxQuantity = reader.ReadInt32();
                        products.Add(new Product(weight, calories, maxQuantity));
                    }
                }

                Console.WriteLine($"Данные успешно загружены из двоичного файла: {filename}");
                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка при загрузке из двоичного файла: {ex.Message}");
                return false;
            }
        }
    }
}
```

**Примечание:** Полный листинг файла Program.cs слишком большой для включения в отчет. Все методы класса Program реализуют функции меню, ввода/вывода данных и взаимодействия с пользователем. Полный код доступен в файле `KursovayaWork/Program.cs`.

